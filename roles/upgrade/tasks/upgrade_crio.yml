- name: Ensure Kubic libcontainers repository
  yum_repository:
    name: devel_kubic_libcontainers_stable_cri-o_{{ crio_version }}
    description: devel_kubic_libcontainers_stable_cri-o_{{ crio_version }}
    baseurl: 'https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable:/cri-o:/{{ crio_version }}/{{ crio_os }}/'
    gpgcheck: true
    gpgkey: 'https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable:/cri-o:/{{ crio_version }}/{{ crio_os }}/repodata/repomd.xml.key'
    enabled: true
    exclude: cri-o

  become: true

- name: Ensure cri-o package is latest
  yum:
    name: cri-o
    state: latest
    disable_excludes: devel_kubic_libcontainers_stable_cri-o_{{ crio_version }}

  become: true
  register: _crio_update

- name: Ensure cri-o is restarted and enabled
  systemd:
    name: crio.service
    state: restarted
    enabled: true
    daemon_reload: true
  
  become: true
  when: _crio_update.changed