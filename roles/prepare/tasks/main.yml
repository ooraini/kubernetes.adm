---
- include_tasks: "{{ swap_tasks }}"

- include_tasks: "{{ cni_tasks }}"

- include_tasks: "{{ cri_tasks }}"

- include_tasks: "{{ install_kube_tasks }}"

- name: Ensure patches directory
  file:
    path: "{{ kubeadm_patches_directory }}"
    state: directory

  become: true

- name: Ensure kernel parameters are relaoded
  command: sysctl -p
  become: true

- name: Ensure kubelet.service is enabled
  systemd:
    name: kubelet.service
    enabled: true
    daemon_reload: true

  become: true

- name: Ensure bash completion
  include_tasks: "{{ completion_tasks }}"
  when: is_control_plane