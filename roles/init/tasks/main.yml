- assert:
    that: ansible_play_hosts | length == 1 and is_control_plane
    fail_msg: init SHOULD run on a single control plane host
    quiet: true

- name: Check if node is initialized
  find:
    use_regex: true
    patterns: '(?!kubeadm\.conf).*$'
    paths:
      - /etc/kubernetes/

  become: true
  register: etc_kubernetes_out

- include_tasks: init.yml
  when: etc_kubernetes_out.matched == 0
